<div class="reports-container" role="main" aria-labelledby="reports-page-title">

  <!-- Loading State -->
  @if (loading) {
    <div class="loading-container" role="status" aria-live="polite">
      <div class="spinner" aria-hidden="true"></div>
      <p>Loading temperature efficiency data...</p>
    </div>
  }

  <!-- Error State -->
  @if (error && !loading) {
    <div class="error-container" role="alert" aria-live="assertive">
      <div class="error-icon" aria-hidden="true">âš </div>
      <h2>Error Loading Reports Data</h2>
      <p>{{ error }}</p>
      <button class="retry-button" (click)="loadChartData()" aria-label="Retry loading reports data">
        Retry
      </button>
    </div>
  }

  <!-- Reports Content -->
  @if (chartData && !loading && !error) {
    <div class="reports-content">
      <!-- Page Header -->
      <header class="page-header">
        <h1 id="reports-page-title" class="page-title">
          <span class="page-icon" aria-hidden="true">ğŸ“‹</span>
          Reports: Temperature Efficiency Analysis
        </h1>
        <p class="page-subtitle">Comparative analysis of CO yield across temperature ranges for different catalysts</p>

        <!-- Key Metrics Banner -->
        <div class="metrics-banner" role="region" aria-label="Key performance metrics">
          <div class="metric-badge">
            <span class="metric-label">Optimal Temperature</span>
            <span class="metric-value">{{ getOptimalTemperature() }}</span>
            <span class="metric-desc">KIER Catalyst</span>
          </div>
          <div class="metric-badge">
            <span class="metric-label">Max Efficiency</span>
            <span class="metric-value">{{ getMaxEfficiency() }}%</span>
            <span class="metric-desc">CO Yield</span>
          </div>
          <div class="metric-badge">
            <span class="metric-label">Energy Savings</span>
            <span class="metric-value">50%</span>
            <span class="metric-desc">vs Traditional</span>
          </div>
        </div>
      </header>

      <div class="reports-layout">
        <!-- Main Chart Card -->
        <section class="chart-card" aria-labelledby="reports-chart-title">
          <div class="card-header">
            <div class="chart-header-content">
              <h2 id="reports-chart-title" class="chart-title">{{ chartData.title }}</h2>
              <p class="chart-description">{{ chartData.description }}</p>
            </div>

            <div class="chart-actions">
              <button
                class="action-button download-button"
                (click)="downloadChart()"
                aria-label="Download temperature efficiency chart as PNG"
              >
                <span class="button-icon" aria-hidden="true">ğŸ’¾</span>
                Download Chart
              </button>

              <button
                class="action-button refresh-button"
                (click)="loadChartData()"
                aria-label="Refresh chart data"
              >
                <span class="button-icon" aria-hidden="true">ğŸ”„</span>
                Refresh Data
              </button>
            </div>
          </div>

          <div class="card-body">
            <!-- Chart Container -->
            <div class="chart-container" role="region" aria-label="Interactive temperature efficiency chart">
              <canvas
                #chartCanvas
                id="reportsChart"
                width="800"
                height="400"
                role="img"
                [attr.aria-label]="chartData.title + '. ' + chartData.description"
                tabindex="0"
              ></canvas>
            </div>

            <!-- Interactive Legend -->
            <div class="interactive-legend" role="group" aria-label="Chart legend">
              <h3 class="legend-title">Data Series</h3>
              <div class="legend-controls">
                @for (dataset of chartData.data.datasets; track dataset.label; let i = $index) {
                  <div class="legend-control">
                    <span
                      class="legend-color"
                      [style.borderColor]="dataset.borderColor"
                      aria-hidden="true"
                    ></span>
                    <span class="legend-label">{{ dataset.label }}</span>
                    <span class="legend-stats">
                      Max: {{ getMaxValue(dataset.data) }}% at {{ getTempAtMax(dataset.data) }}
                    </span>
                  </div>
                }
              </div>
            </div>
          </div>
        </section>

        <!-- Analysis & Insights -->
        <section class="analysis-card" aria-labelledby="analysis-title">
          <div class="card-header">
            <h2 id="analysis-title" class="card-title">
              <span class="card-icon" aria-hidden="true">ğŸ”</span>
              Detailed Analysis & Insights
            </h2>
          </div>

          <div class="card-body">
            <div class="analysis-content">
              <p class="analysis-text">{{ chartData.explanation }}</p>

              <!-- Temperature Analysis -->
              <div class="temperature-analysis">
                <h3 class="analysis-section-title">Temperature Performance Analysis</h3>
                <div class="analysis-grid">
                  @for (dataset of chartData.data.datasets; track dataset.label) {
                    <div class="analysis-item">
                      <h4 class="analysis-item-title">{{ dataset.label }}</h4>
                      <div class="analysis-details">
                        <div class="detail-row">
                          <span class="detail-label">Optimal Temp:</span>
                          <span class="detail-value">
                            {{ getTempAtMax(dataset.data) }}
                          </span>
                        </div>
                        <div class="detail-row">
                          <span class="detail-label">Max Yield:</span>
                          <span class="detail-value">{{ getMaxValue(dataset.data) }}%</span>
                        </div>
                        <div class="detail-row">
                          <span class="detail-label">Temp Range:</span>
                          <span class="detail-value">300-500Â°C</span>
                        </div>
                        <div class="detail-row">
                          <span class="detail-label">Efficiency at 400Â°C:</span>
                          <span class="detail-value">{{ dataset.data[2] }}%</span>
                        </div>
                      </div>
                    </div>
                  }
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  }
</div>
