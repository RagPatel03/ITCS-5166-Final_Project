<div class="dashboard-container" role="main" aria-labelledby="dashboard-title">

  <!-- Loading State -->
  @if (loading) {
    <div class="loading-container" role="status" aria-live="polite">
      <div class="spinner" aria-hidden="true"></div>
      <p>Loading dashboard data...</p>
    </div>
  }

  <!-- Error State -->
  @if (error && !loading) {
    <div class="error-container" role="alert" aria-live="assertive">
      <div class="error-icon" aria-hidden="true">‚ö†</div>
      <h2>Error Loading Dashboard</h2>
      <p>{{ error }}</p>
      <button class="retry-button" (click)="loadDashboardData()" aria-label="Retry loading dashboard">
        Retry
      </button>
    </div>
  }

  <!-- Dashboard Content -->
  @if (dashboardData && !loading && !error) {
    <div class="dashboard-content">
      <!-- Dashboard Header -->
      <header class="dashboard-header">
        <h1 id="dashboard-title" class="dashboard-title">R03 Clean Energy Dashboard</h1>
        <div class="user-welcome">
          <span class="welcome-text">Welcome,</span>
          <span class="user-name">{{ getCurrentUser()?.name || 'User' }}</span>
        </div>
      </header>

      <!-- Main Content Grid -->
      <div class="dashboard-grid">
        <!-- Summary Section -->
        <section class="card summary-section" aria-labelledby="summary-title">
          <div class="card-header">
            <h2 id="summary-title" class="card-title">
              <span class="card-icon" aria-hidden="true">üìù</span>
              Clean Energy Innovation Summary
            </h2>
          </div>
          <div class="card-body">
            <div class="summary-content">
              <p class="summary-text">{{ dashboardData.summary }}</p>

              <!-- Word Count (200 words requirement) -->
              <div class="word-count" role="status" aria-live="polite">
                <span class="count-label">Word Count:</span>
                <span class="count-value">{{ dashboardData.summary.split(' ').length }} words</span>
                <span class="count-status" [class.valid]="dashboardData.summary.split(' ').length >= 200">
                  {{ dashboardData.summary.split(' ').length >= 200 ? '‚úì Requirement met' : '‚úó Need more words' }}
                </span>
              </div>
            </div>
          </div>
        </section>

        <!-- Source Section -->
        <section class="card source-section" aria-labelledby="source-title">
          <div class="card-header">
            <h2 id="source-title" class="card-title">
              <span class="card-icon" aria-hidden="true">üîó</span>
              Article Source
            </h2>
          </div>
          <div class="card-body">
            <div class="source-content">
              <h3 class="source-heading">Turning CO2 into clean fuel faster and cheaper</h3>
              <p class="source-description">Researchers in Korea have created a low-temperature copper catalyst that converts CO2 into fuel components with record speed and efficiency.</p>

              <div class="source-link-container">
                <a
                  [href]="dashboardData.source"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="source-link"
                  aria-label="Open article source in new tab"
                >
                  <span class="link-icon" aria-hidden="true">üîó</span>
                  View Full Article on ScienceDaily
                </a>
                <span class="link-hint">(Opens in new tab)</span>
              </div>

              <div class="source-meta">
                <div class="meta-item">
                  <span class="meta-label">Date:</span>
                  <span class="meta-value">November 5, 2025</span>
                </div>
                <div class="meta-item">
                  <span class="meta-label">Source:</span>
                  <span class="meta-value">National Research Council of Science & Technology</span>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Technical Details -->
        <section class="card technical-section" aria-labelledby="technical-title">
          <div class="card-header">
            <h2 id="technical-title" class="card-title">
              <span class="card-icon" aria-hidden="true">‚öôÔ∏è</span>
              Technical Implementation
            </h2>
          </div>
          <div class="card-body">
            <div class="technical-content">
              <p class="technical-text">{{ dashboardData.technical }}</p>

              <div class="tech-stack">
                <h3 class="tech-title">Technology Stack:</h3>
                <div class="tech-tags">
                  <span class="tech-tag frontend">Angular 18</span>
                  <span class="tech-tag backend">Node.js/Express</span>
                  <span class="tech-tag database">MySQL</span>
                  <span class="tech-tag auth">JWT</span>
                  <span class="tech-tag chart">Chart.js</span>
                  <span class="tech-tag server">NGINX</span>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Database Status -->
        <section class="card database-section" aria-labelledby="database-title">
          <div class="card-header">
            <h2 id="database-title" class="card-title">
              <span class="card-icon" aria-hidden="true">üíæ</span>
              Database Status
            </h2>
          </div>
          <div class="card-body">
            <div class="database-content">
              <div class="status-indicator">
                <div class="status-dot active" aria-hidden="true"></div>
                <span class="status-text">{{ dashboardData.database }}</span>
              </div>

              <div class="database-info">
                <div class="info-item">
                  <span class="info-label">Type:</span>
                  <span class="info-value">MySQL</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Mode:</span>
                  <span class="info-value">{{ dashboardData.database.includes('mock') ? 'Mock (Hardcoded)' : 'Live Connection' }}</span>
                </div>
                <div class="info-item">
                  <span class="info-label">User:</span>
                  <span class="info-value">{{ dashboardData.user?.username || 'raghav' }}</span>
                </div>
              </div>

              <div class="database-note" role="note" aria-label="Database implementation note">
                <p><strong>Note:</strong> {{ dashboardData.database.includes('mock') ? 'Using mock MySQL connection with hardcoded data for demonstration.' : 'Connected to live MySQL database.' }}</p>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  }
</div>
